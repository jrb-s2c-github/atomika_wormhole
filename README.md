# atomika_wormhole
Atomika wormhole automates the preparation of machines for use as Kubernetes or Ansible Control nodes. The primary 
vehicle is an ISO image of Ubuntu 22 that 
* boots up without user input;
* is minimalistic and
* is pre-installed with Ansible.

As such it supports the corresponding version [jrb-s2c-github/atomika](https://github.com/jrb-s2c-github/atomika)

## Windows
This allows a PowerShell script to start instances of Ubuntu 22 Windows as Virtual Machines that does not require human 
interaction with the Windows Hypervizor HyperV. This script depends on [OpenSSH](https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_overview)
to drop one directly into a ssh shell on the new virtual machine.

### Howto create new Virtual Machine
* Git clone both atomika and atomika_wormhole into the same parent folder.  
* Download the correct version of the image from [here](https://drive.google.com/drive/folders/1OY1rDy6MwYi0iXD159igjnJ7IOrBbJ1U)
into /startup_scripts. ISO versions follow that of the versions of Atomika they are prepared for.
* Run /startup_scripts/liftoff.ps1 from a PowerShell prompt with administration privileges
* Enter a name for the virtual machine that will be created when prompted
* Wait to be dropped into a SSH shell on the VM.

### Howto reconnect or restart existing Virtual Machine
Run /startup_scripts/startReconnect.ps1 in a PowerShell prompt with admin privileges. Since IP addresses might change 
after restarts, there might be prompts requesting trust to be established again.

#### Troubleshooting
First of all check that the virtual machine is running by connecting to it directly from the Hyper-V manager application.

Should it be running, but the SSH prompt did not appear:
* Check that the atomika project has been cloned into the same parent folder as atomika_wormhole. Wormhole gets the SSH
public key from atomika when estabishing the SSH tunnel.
* Confirm that [OpenSSH]((https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_overview)) is 
installed. One can also get a shell by connecting from the Hyper-V manager application directly.

## Outstanding
* Test assumptions that HyperV is present and active on Windows 10&11 with Default Switch
* Test assumptions that HyperV Default Switch is generated by OS
* Should HyperV not be active by default, can it it be activated by a script? 
* Script to install OpenSSH
* Tune size of Windows VM
* Switch on compression of iso images?
* Provide hash to compare iso against
